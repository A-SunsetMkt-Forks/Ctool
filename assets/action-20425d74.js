import{bQ as g,bX as p,bE as v,r as S,aw as x,bu as n,t as I,c7 as w,bx as z,bF as b,c8 as D,c9 as $,bY as q,bM as E,by as H}from"./history-d3ff5000.js";const N=async(c,a=!0,e="input")=>{var o,_;const u=g(),f=p(u.items.tool,u.items.feature),y=$(),i=v();e&&!(e in c)&&(e="",a=!1);const m=e&&q(c[e]),r=t=>(e&&n.isNumber(c[e])&&t[e]&&(t[e]=n.toNumber(t[e])),{items:n.cloneDeep(t),field:e});let s=n.cloneDeep(c);if(e&&((o=y.query)!=null&&o.input)){let t=`${y.query.input}`;if(t==="_temp_storage"&&(t=E.get(t)||""),t!=="")return m?(s[e].value=t,r(s)):r({...s,[e]:t})}if(f.length()>0){const t=f.get(parseInt((((_=y.query)==null?void 0:_.history)||"").toString())||0);if(t)return r(n.mergeWith(s,t,(h,O)=>{if(w(h))return h.unserialize(O)}))}if(e&&a!==!1&&i.items.auto_read_copy){const t=await H();if(t.trim()&&(a===!0||a(t)))return m?(s[e].value=i.items.auto_read_copy_filter?t.trim():t,r(s)):r({...s,[e]:i.items.auto_read_copy_filter?t.trim():t})}return r(s)},R=c=>{const a=g(),e=p(a.items.tool,a.items.feature),u=v(),f=S(c.items);x(()=>{e.save()});const y=n.debounce(function(){const r=s=>{if(!n.isObject(s))return s;if(w(s)){if(!s.isSaveHistory())throw new Error("Do not save");return s.serialize()}for(let o in s)s[o]=r(s[o]);return s};try{e.push(r(n.cloneDeep(I(f))))}catch{}},500),i=()=>{y()};return{current:f,save:i,success:({message:r=$t("main_ui_success"),message_type:s="success",copy_text:o="",copy_image:_="",is_save:t=!0}={})=>{if(t&&i(),o!==""&&u.items.auto_save_copy)return z(o,()=>{b.success($t("main_ui_copy_text_ok"))});if(_!==""&&u.items.auto_save_copy)return D(_,()=>{b.success($t("main_ui_copy_image_ok"))});r!==""&&b[s](r,{offset:150,showClose:!0})}}};export{N as i,R as u};
