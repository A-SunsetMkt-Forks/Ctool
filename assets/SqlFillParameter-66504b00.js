import{u as I,i as P}from"./action-4599c846.js";import{d as w,y as T,z as A,D as b,c as O,w as S,r as h,B as k,f as _,v as c,A as R,k as V,j as u}from"./tool-65d7eee7.js";import"./modulepreload-polyfill-3cfb730f.js";const F=w({__name:"SqlFillParameter",async setup($){let m,g;const p=["String","Integer","Long","Timestamp"],n=I(([m,g]=T(()=>P({input:"",params:""})),m=await m,g(),m)),v=e=>{if(e){let o=e.split(",",-1),t=[],l=0,s=!1;return o.forEach(r=>{r.endsWith("null")?(t.push(r),l++):r.endsWith(")")?(s?(t[l]+=","+r,s=!1):t.push(r),l++):t[l]?t[l]+=","+r:(t.push(r),s=!0)}),t.map(r=>{let i=r.lastIndexOf("(");if(i<0)return{value:r,type:null};let a=r.substring(0,i);a=a.trim(),a=a.replaceAll("'","\\'");let d=r.lastIndexOf(")");d<0&&(d=r.length);let f=r.substring(i+1,d);return f=f.trim(),{value:a,type:f}})}else return[]},E=()=>{if(!n.current.input||!n.current.params)return"";let e=v(n.current.params),o=n.current.input,t="",l=0,s="";for(let r=0;r<o.length;r++){let i=o.charAt(r);if(i==="?"){if(e.length<=l)throw new Error($t("sqlFillParameter_parameter_too_little"));let a=e[l];switch(a.type){case p[0]:s=" '"+a.value+"'";break;case p[1]:case p[2]:s=a.value;break;case p[3]:s="Timestamp '"+a.value+"'";break;default:s=a.value}t+=s,l++}else t+=i}return t},q=e=>{const o={sql:"",params:""};let t="Preparing:",l=e.indexOf(t);l<0?l=0:l+=t.length;let s=e.indexOf(`
`,l);s<0&&(s=e.length),o.sql=e.substring(l,s);let r="Parameters:",i=e.indexOf(r);if(i>=0){let a=e.indexOf(`
`,i);a<0&&(a=e.length),o.params=e.substring(i+r.length,a)}return o},y=A(()=>{try{if(!n.current.input||!n.current.params)return"";let e=E();return n.save(),e}catch(e){return $error(e)}});return b(()=>({input:n.current.input,params:n.current.params}),({input:e,params:o})=>{if(e!==""&&e.includes("Preparing:")&&e.includes("Parameters:")){const t=q(e);t.sql!==""&&t.params!==""&&setTimeout(()=>{n.current.input=t.sql,n.current.params=t.params})}},{immediate:!0}),(e,o)=>{const t=h("Textarea"),l=h("Align"),s=h("HeightResize"),r=k("row");return _(),O(s,{ignore:"",reduce:5},{default:S(({height:i})=>[c(l,{direction:"vertical"},{default:S(()=>[R((_(),V("div",null,[c(t,{modelValue:u(n).current.input,"onUpdate:modelValue":o[0]||(o[0]=a=>u(n).current.input=a),height:i/2,placeholder:"Sql:SELECT * FROM T WHERE id=? AND name = ?",copy:"Sql"},null,8,["modelValue","height"]),c(t,{modelValue:u(n).current.params,"onUpdate:modelValue":o[1]||(o[1]=a=>u(n).current.params=a),height:i/2,placeholder:`${e.$t("sqlFillParameter_parameter")}:1(Integer),zhangshan(String)`,copy:e.$t("sqlFillParameter_parameter")},null,8,["modelValue","height","placeholder","copy"])])),[[r,"1-1"]]),c(t,{"model-value":u(y),copy:"",height:i/2,placeholder:`${e.$t("main_ui_output")}:SELECT * FROM T WHERE id=1 AND name='zhangshan'`},null,8,["model-value","height","placeholder"])]),_:2},1024)]),_:1})}}});export{F as default};
