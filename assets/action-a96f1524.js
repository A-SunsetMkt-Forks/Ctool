import{b$ as O,c3 as k,bH as z,az as S,bv as n,aX as H,cc as x,bA as D,by as b,bx as W,cd as $,c4 as E,bO as T,ce as j,bB as A,bU as I}from"./history-032965eb.js";const R=async(a,{input:e="input",keyword:l=u=>!1,paste:y=u=>!0}={})=>{const u=O(),f=k(u.items.tool,u.items.feature),h=$(),_=z(),i=t=>{var v;const c=(v=h.query)==null?void 0:v[t];return n.isString(c)?c:""},r=(()=>{const t=i("keyword");return t===""?!1:l(t)})(),s=t=>(e&&n.isNumber(a[e])&&t[e]&&(t[e]=n.toNumber(t[e])),{items:n.cloneDeep(t),field:e});e&&!(e in a)&&(e="",y=!1);const p=e&&E(a[e]);a=r?n.merge(a,r):a;let o=n.cloneDeep(a);if(e){let t=T.get("_temp_input_storage")||i("input");if(t!=="")return p?(o[e].value=t,s(o)):s({...o,[e]:t})}const w=i("history")!==""?f.get(parseInt(i("history"))):null;if(w)return s(n.mergeWith(o,w,(t,c)=>{if(x(t))return t.unserialize(c)}));const g=(()=>{if(f.length()<1)return null;if(r){const t=f.all();for(let c in t)if(j(r,t[c].v))return f.getWithTime(parseInt(c));return null}return f.getWithTime(0)})(),m=await(async()=>{if(e&&y!==!1&&_.items.auto_read_copy){const t=await A();if(t.trim()&&y(t))return _.items.auto_read_copy_filter?t.trim():t}return""})();return g&&(m===""||I().unix()-I(g.t).unix()<_.items.fill_history_expire)?s(n.mergeWith(o,g.v,(t,c)=>{if(x(t))return t.unserialize(c)})):m?p?(o[e].value=_.items.auto_read_copy_filter?m.trim():m,s(o)):s({...o,[e]:_.items.auto_read_copy_filter?m.trim():m}):s(o)},U=a=>{const e=O(),l=k(e.items.tool,e.items.feature),y=z(),u=S(a.items),f=n.debounce(function(){const i=r=>{if(!n.isObject(r))return r;if(x(r)){if(!r.isSaveHistory())throw new Error("Do not save");return r.serialize()}for(let s in r)r[s]=i(r[s]);return r};try{l.push(i(n.cloneDeep(H(u))))}catch{}},500),h=()=>{f()};return{current:u,save:h,success:({message:i=$t("main_ui_success"),message_type:r="success",copy_text:s="",copy_image:p="",is_save:o=!0}={})=>{if(o&&h(),s!==""&&y.items.auto_save_copy)return D(s,()=>{b.success($t("main_ui_copy_text_ok"))});if(p!==""&&y.items.auto_save_copy)return W(p,()=>{b.success($t("main_ui_copy_image_ok"))});i!==""&&b[r](i,{offset:150})}}};export{R as i,U as u};
