import{u as E,i as y}from"./action-b0774d39.js";import{d as P,y as w,z as x,D as I,c as T,w as h,r as d,B as A,f as g,v as c,A as O,k as b,j as u}from"./tool-86fca7a1.js";import"./modulepreload-polyfill-3cfb730f.js";const z=P({__name:"SqlFillParameter",async setup(k){let m,f;const p=["String","Integer","Long","Timestamp"],r=E(([m,f]=w(()=>y({input:"",params:""})),m=await m,f(),m)),_=e=>e?e.split(",",-1).map(t=>{let a=t.lastIndexOf("(");if(a<0)return{value:t,type:null};let l=t.substring(0,a);l=l.trim();let o=t.lastIndexOf(")");o<0&&(o=t.length);let n=t.substring(a+1,o);return n=n.trim(),{value:l,type:n}}):[],S=()=>{if(!r.current.input||!r.current.params)return"";let e=_(r.current.params),s=r.current.input,t="",a=0,l="";for(let o=0;o<s.length;o++){let n=s.charAt(o);if(n==="?"){if(e.length<=a)throw new Error($t("sqlFillParameter_parameter_too_little"));let i=e[a];switch(i.type){case p[0]:l=" '"+i.value+"'";break;case p[1]:case p[2]:l=i.value;break;case p[3]:l="Timestamp '"+i.value+"'";break;default:l=i.value}t+=l,a++}else t+=n}return t},v=e=>{const s={sql:"",params:""};let t="Preparing:",a=e.indexOf(t);a<0?a=0:a+=t.length;let l=e.indexOf(`
`,a);l<0&&(l=e.length),s.sql=e.substring(a,l);let o="Parameters:",n=e.indexOf(o);if(n>=0){let i=e.indexOf(`
`,n);i<0&&(i=e.length),s.params=e.substring(n+o.length,i)}return s},q=x(()=>{try{if(!r.current.input||!r.current.params)return"";let e=S();return r.save(),e}catch(e){return $error(e)}});return I(()=>({input:r.current.input,params:r.current.params}),({input:e,params:s})=>{if(e!==""&&e.includes("Preparing:")&&e.includes("Parameters:")){const t=v(e);t.sql!==""&&t.params!==""&&setTimeout(()=>{r.current.input=t.sql,r.current.params=t.params})}},{immediate:!0}),(e,s)=>{const t=d("Textarea"),a=d("Align"),l=d("HeightResize"),o=A("row");return g(),T(l,{ignore:"",reduce:5},{default:h(({height:n})=>[c(a,{direction:"vertical"},{default:h(()=>[O((g(),b("div",null,[c(t,{modelValue:u(r).current.input,"onUpdate:modelValue":s[0]||(s[0]=i=>u(r).current.input=i),height:n/2,placeholder:"Sql:SELECT * FROM T WHERE id=? AND name = ?",copy:"Sql"},null,8,["modelValue","height"]),c(t,{modelValue:u(r).current.params,"onUpdate:modelValue":s[1]||(s[1]=i=>u(r).current.params=i),height:n/2,placeholder:`${e.$t("sqlFillParameter_parameter")}:1(Integer),zhangshan(String)`,copy:e.$t("sqlFillParameter_parameter")},null,8,["modelValue","height","placeholder","copy"])])),[[o,"1-1"]]),c(t,{"model-value":u(q),copy:"",height:n/2,placeholder:`${e.$t("main_ui_output")}:SELECT * FROM T WHERE id=1 AND name='zhangshan'`},null,8,["model-value","height","placeholder"])]),_:2},1024)]),_:1})}}});export{z as default};
