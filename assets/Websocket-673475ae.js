import{u as H,i as I}from"./action-cc5da9d8.js";import{A as D,bi as F,aA as N,m as d,bj as a,aF as i,aG as W,as as l,x as r,p as _,ae as U,a$ as k,bl as j,o as m,aD as R,ac as q,F as g,w as y,aT as w,c7 as G,ab as J}from"./history-4c0a99f7.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";import"./shim-03580cdb.js";import"./_commonjsHelpers-87174ba5.js";const O={class:"ctool-websocket-logs-item"},K={class:"ctool-websocket-logs-top"},M={class:"ctool-websocket-logs-time"},P={class:"ctool-websocket-logs-content"},Q=D({__name:"Websocket",async setup(X){let v,$;const s=H(([v,$]=F(()=>I({url:"wss://echo.websocket.events",keepScroll:!0},{paste:e=>/^ws/.test(e)})),v=await v,$(),v)),o=N({status:!1,ws:null,send_content:"",logs:[]}),u=async(e,t="other")=>{if(o.value.logs.push({content:e,type:t,time:G().format("HH:mm:ss")}),await J(),s.current.keepScroll){const c=document.querySelector(".ctool-websocket-logs .ctool-card-body");c&&(c.scrollTop=c.scrollHeight)}},f=()=>{if(!s.current.url.trim())return;s.save(),u($t("websocket_connect_start",[s.current.url]));let e=new WebSocket(s.current.url);e.onopen=()=>{o.value.status=!0,u($t("websocket_connect_ok"))},e.onclose=()=>{o.value.status=!1,u($t("websocket_close_ok"))},e.onmessage=t=>{u(t.data,"accept")},e.onerror=t=>{u($t("websocket_error",[t]))},o.value.ws=e},C=()=>{var e;o.value.status&&(u($t("websocket_close_start",[s.current.url])),(e=o.value.ws)==null||e.close())},h=()=>{var e;if(!o.value.status)throw new Error($t("websocket_error_connect"));if(o.value.send_content==="")throw new Error($t("websocket_error_content"));try{(e=o.value.ws)==null||e.send(o.value.send_content),u(o.value.send_content,"send")}catch(t){u($error(t))}};return(e,t)=>{const c=i("Align"),b=i("Button"),x=i("Input"),V=i("Textarea"),z=i("Bool"),S=i("Exception"),B=i("Icon"),T=i("Card"),A=i("HeightResize"),E=W("row");return l(),d(c,{direction:"vertical"},{default:a(()=>[r(x,{modelValue:k(s).current.url,"onUpdate:modelValue":t[2]||(t[2]=p=>k(s).current.url=p),class:"ctool-page-option"},{prepend:a(()=>[r(c,{horizontal:"center",vertical:"center",width:20},{default:a(()=>[_("div",{style:U([{backgroundColor:o.value.status?"#19be6b":"#ed4014"},{"border-radius":"50%",height:"7px",width:"7px",display:"inline-block"}])},null,4)]),_:1})]),append:a(()=>[o.value.status?(l(),d(b,{key:1,onClick:t[1]||(t[1]=p=>C()),text:e.$t("websocket_close")},null,8,["text"])):(l(),d(b,{key:0,onClick:t[0]||(t[0]=p=>f()),text:e.$t("websocket_connect")},null,8,["text"]))]),_:1},8,["modelValue"]),j((l(),d(A,{ignore:"",reduce:5,append:[".ctool-page-option"]},{default:a(({height:p})=>[r(V,{height:p,modelValue:o.value.send_content,"onUpdate:modelValue":t[3]||(t[3]=n=>o.value.send_content=n),"float-text":e.$t("websocket_send"),"float-position":"top-right",onClickFloatText:h,placeholder:`${e.$t("main_ui_input")}${e.$t("websocket_send_content")}`},null,8,["height","modelValue","float-text","placeholder"]),r(T,{title:e.$t("websocket_log_content"),height:p,class:"ctool-websocket-logs"},{extra:a(()=>[r(c,null,{default:a(()=>[r(b,{size:"small",type:"primary",text:e.$t("main_ui_copy"),onClick:t[4]||(t[4]=()=>e.$copy(JSON.stringify(o.value.logs)))},null,8,["text"]),r(b,{size:"small",type:"danger",text:e.$t("main_ui_clear"),onClick:t[5]||(t[5]=n=>o.value.logs=[])},null,8,["text"]),r(z,{size:"small",modelValue:k(s).current.keepScroll,"onUpdate:modelValue":t[6]||(t[6]=n=>k(s).current.keepScroll=n),border:"",label:e.$t("websocket_keep_scroll"),onChange:t[7]||(t[7]=n=>k(s).save())},null,8,["modelValue","label"])]),_:1})]),default:a(()=>[o.value.logs.length<1?(l(),d(c,{key:0,horizontal:"center",vertical:"center"},{default:a(()=>[r(S)]),_:1})):(l(),d(c,{key:1,direction:"vertical"},{default:a(()=>[(l(!0),m(g,null,R(o.value.logs,n=>(l(),m("div",O,[_("div",K,[_("div",{class:q(["ctool-websocket-logs-type",`ctool-websocket-logs-type-${n.type}`])},[n.type==="send"?(l(),m(g,{key:0},[y(w(e.$t("websocket_client"))+"：",1)],64)):n.type==="accept"?(l(),m(g,{key:1},[y(w(e.$t("websocket_server"))+"：",1)],64)):(l(),m(g,{key:2},[y(w(e.$t("websocket_tips"))+"：",1)],64))],2),_("div",M,w(n.time),1),r(B,{size:12,name:"copy",tooltip:e.$t("main_ui_copy"),hover:"",onClick:Y=>e.$copy(n.content)},null,8,["tooltip","onClick"])]),_("pre",P,[_("code",null,w(n.content),1)])]))),256))]),_:1}))]),_:2},1032,["title","height"])]),_:1},8,["append"])),[[E,"40-60"]])]),_:1})}}});const se=L(Q,[["__scopeId","data-v-45590822"]]);export{se as default};
