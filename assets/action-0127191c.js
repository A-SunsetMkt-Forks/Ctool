import{bQ as g,bX as p,bE as v,ay as w,aq as x,bu as a,aW as I,c7 as O,bx as q,bF as b,c8 as z,c9 as D,bY as $,bM as E,by as H}from"./history-91b4f808.js";const N=async(c,n=!0,e="input")=>{var o,_;const u=g(),f=p(u.items.tool,u.items.feature),y=D(),i=v();e&&!(e in c)&&(e="",n=!1);const m=e&&$(c[e]),r=t=>(e&&a.isNumber(c[e])&&t[e]&&(t[e]=a.toNumber(t[e])),{items:a.cloneDeep(t),field:e});let s=a.cloneDeep(c);if(e&&((o=y.query)!=null&&o.input)){let t=`${y.query.input}`;if(t==="_temp_storage"&&(t=E.get(t)||""),t!=="")return m?(s[e].value=t,r(s)):r({...s,[e]:t})}if(f.length()>0){const t=f.get(parseInt((((_=y.query)==null?void 0:_.history)||"").toString())||0);if(t)return r(a.mergeWith(s,t,(h,S)=>{if(O(h))return h.unserialize(S)}))}if(e&&n!==!1&&i.items.auto_read_copy){const t=await H();if(t.trim()&&(n===!0||n(t)))return m?(s[e].value=i.items.auto_read_copy_filter?t.trim():t,r(s)):r({...s,[e]:i.items.auto_read_copy_filter?t.trim():t})}return r(s)},R=c=>{const n=g(),e=p(n.items.tool,n.items.feature),u=v(),f=w(c.items);x(()=>{e.save()});const y=a.debounce(function(){const r=s=>{if(!a.isObject(s))return s;if(O(s)){if(!s.isSaveHistory())throw new Error("Do not save");return s.serialize()}for(let o in s)s[o]=r(s[o]);return s};try{e.push(r(a.cloneDeep(I(f))))}catch{}},500),i=()=>{y()};return{current:f,save:i,success:({message:r=$t("main_ui_success"),message_type:s="success",copy_text:o="",copy_image:_="",is_save:t=!0}={})=>{if(t&&i(),o!==""&&u.items.auto_save_copy)return q(o,()=>{b.success($t("main_ui_copy_text_ok"))});if(_!==""&&u.items.auto_save_copy)return z(_,()=>{b.success($t("main_ui_copy_image_ok"))});r!==""&&b[s](r,{offset:150,showClose:!0})}}};export{N as i,R as u};
