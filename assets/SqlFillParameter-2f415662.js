import{u as E,i as P}from"./action-2a63f34c.js";import{D as b,bj as w,l as x,bf as y,n as I,bk as f,aG as d,aH as T,at as g,y as p,bm as A,p as O,b0 as c}from"./history-697a3b4f.js";import"./shim-03580cdb.js";import"./_commonjsHelpers-87174ba5.js";const C=b({__name:"SqlFillParameter",async setup($){let m,h;const u=["String","Integer","Long","Timestamp"],a=E(([m,h]=w(()=>P({input:"",params:""})),m=await m,h(),m)),_=e=>e?e.split(",",-1).map(t=>{let s=t.lastIndexOf("(");if(s<0)throw new Error($t("sqlFillParameter_invalid_param",[t]));let n=t.substring(0,s);n=n.trim();let i=t.lastIndexOf(")");i<0&&(i=t.length);let r=t.substring(s+1,i);return r=r.trim(),{value:n,type:r}}):[],S=()=>{if(!a.current.input||!a.current.params)return"";let e=_(a.current.params),l=a.current.input,t="",s=0,n="";for(let i=0;i<l.length;i++){let r=l.charAt(i);if(r==="?"){if(e.length<=s)throw new Error($t("sqlFillParameter_parameter_too_little"));let o=e[s];switch(o.type){case u[0]:n=" '"+o.value+"'";break;case u[1]:case u[2]:n=o.value;break;case u[3]:n="Timestamp '"+o.value+"'";break;default:n=o.value}t+=n,s++}else t+=r}return t},v=e=>{const l={sql:"",params:""};let t="Preparing:",s=e.indexOf(t);if(s>=0){let r=e.indexOf(`
`,s);r<0&&(r=e.length),l.sql=e.substring(s+t.length,r)}let n="Parameters:",i=e.indexOf(n);if(i>=0){let r=e.indexOf(`
`,i);r<0&&(r=e.length),l.params=e.substring(i+n.length,r)}return l},q=x(()=>{try{if(!a.current.input||!a.current.params)return"";let e=S();return a.save(),e}catch(e){return $error(e)}});return y(()=>({input:a.current.input,params:a.current.params}),({input:e,params:l})=>{if(l===""&&e!==""&&e.includes("Preparing:")&&e.includes("Parameters:")){const t=v(e);t.sql!==""&&t.params!==""&&setTimeout(()=>{a.current.input=t.sql,a.current.params=t.params})}},{immediate:!0}),(e,l)=>{const t=d("Textarea"),s=d("Align"),n=d("HeightResize"),i=T("row");return g(),I(n,{ignore:"",reduce:5},{default:f(({height:r})=>[p(s,{direction:"vertical"},{default:f(()=>[A((g(),O("div",null,[p(t,{modelValue:c(a).current.input,"onUpdate:modelValue":l[0]||(l[0]=o=>c(a).current.input=o),height:r/2,placeholder:"Sql:SELECT * FROM T WHERE id=? AND name = ?",copy:"Sql"},null,8,["modelValue","height"]),p(t,{modelValue:c(a).current.params,"onUpdate:modelValue":l[1]||(l[1]=o=>c(a).current.params=o),height:r/2,placeholder:`${e.$t("sqlFillParameter_parameter")}:1(Integer),zhangshan(String)`,copy:e.$t("sqlFillParameter_parameter")},null,8,["modelValue","height","placeholder","copy"])])),[[i,"1-1"]]),p(t,{"model-value":q.value,copy:"",height:r/2,placeholder:`${e.$t("main_ui_output")}:SELECT * FROM T WHERE id=1 AND name='zhangshan'`},null,8,["model-value","height","placeholder"])]),_:2},1024)]),_:1})}}});export{C as default};
